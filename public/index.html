<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Loove • Music App</title>
<style>
  :root{
    --bg:#0b0f14;
    --card:#121826;
    --muted:#9aa4b2;
    --text:#e6ecf2;
    --accent:#ff2fb3;
    --amber:#ff9f1a;
    --amber-2:#ffb02e;
    --amber-3:#ff7a00;
  }

  /* ================== CHANGELOG ==================
     Edição 11 — Configurações: Preferência musical, Idioma, Mix DJ (crossfade) e Temas
     - Preferência musical com chips persistidos.
     - Idioma do app (pt/es/en) com i18n básico da UI.
     - Mix DJ com crossfade real usando dois <audio> (A/B).
     - Temas: default (cor atual), rosa neon, verde neon, black.
  ================================================= */

  /* ===== TEMAS (aplicados como classes no <body>) ===== */
  body.theme-default{
    --accent:#ff2fb3;
    --bg:#0b0f14;
    --card:#121826;
    --text:#e6ecf2;
  }
  body.theme-pink{
    --accent:#ff31d8;
    --bg:#0a0610;
    --card:#1a1020;
    --text:#ffd6f9;
  }
  body.theme-green{
    --accent:#00ff88;
    --bg:#04120a;
    --card:#0c1e14;
    --text:#d9ffe8;
  }
  body.theme-black{
    --accent:#ffffff;
    --bg:#000000;
    --card:#111111;
    --text:#f5f5f5;
  }

  *{box-sizing:border-box}
  body{
    margin:0;background:
      radial-gradient(1000px 600px at 10% -10%, rgba(49,225,255,.08), transparent 60%),
      radial-gradient(800px 500px at 110% 10%, rgba(255,47,179,.07), transparent 60%),
      var(--bg); color:var(--text);
    font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    min-height:100dvh; padding-bottom:170px;
  }
  .wrap{width:100%; max-width:1060px; margin:0 auto; padding:16px}

  /* ======= HEADER ======= */
  header{position:relative; padding-top:12px; margin-bottom:12px}
  .userbox{position:absolute; top:10px; right:10px; display:flex; align-items:center; gap:10px; cursor:pointer; user-select:none}
  .avatar{width:44px; height:44px; display:grid; place-items:center; border-radius:50%}
  .avatar svg{width:30px; height:30px; stroke:#ffffff; opacity:.95}

  /* ===== Drawer lateral ===== */
  .backdrop{position:fixed; inset:0; background:rgba(0,0,0,.5); display:none; z-index:60}
  .backdrop.open{display:block}
  .menu{position:fixed; top:0; right:0; height:100%; width:320px; background:linear-gradient(180deg,#0f1624,#0b101a);
        border-left:1px solid rgba(255,255,255,.1); box-shadow:0 20px 60px rgba(0,0,0,.6);
        padding:14px; transform:translateX(110%); transition:.25s ease; z-index:70}
  .menu.open{transform:translateX(0)}
  .menu h4{margin:4px 6px 10px; font-size:13px; color:#9aa4b2; font-weight:700}
  .menu .mi{width:100%; text-align:left; padding:12px 12px; border-radius:14px; background:#0c1117; border:1px solid rgba(255,255,255,.08);
            color:#e6ecf2; font-weight:800; display:flex; align-items:center; gap:10px; cursor:pointer}
  .menu .mi:hover{filter:brightness(1.1); box-shadow:0 6px 18px rgba(0,0,0,.35)}
  .menu .mi svg{width:22px; height:22px; stroke:#ffffff; opacity:.95}
  .menu .sep{height:1px; background:rgba(255,255,255,.08); margin:10px 6px}

  /* logo */
  .logo-wrap{ display:flex; align-items:center; justify-content:center; margin-top:20px; text-align:center; }
  .logo{ width:min(300px, 40%); filter:drop-shadow(0 6px 24px rgba(0,0,0,.45)); margin: 0 auto; }
  @media(max-width:600px){ .logo{ width:min(190px, 32vw); margin: 0 auto; } }
  .tagline{ margin-top:8px; text-align:center; font-weight:900; letter-spacing:.4px; color:#fff; font-size:clamp(18px, 4.5vw, 28px); }

  /* busca */
  .search{display:flex; align-items:center; gap:10px; margin:16px auto 8px; max-width:820px}
  .s-ico{display:grid; place-items:center; width:24px; height:24px; opacity:.95}
  .s-ico svg{width:22px; height:22px; stroke:#ffffff}
  .search input{flex:1; padding:16px 16px; border-radius:18px; border:1px solid rgba(255,255,255,.1); background:#0d1320; color:var(--text); font-size:16px}
  .search input:focus{outline:none; box-shadow:0 0 0 2px rgba(49,225,255,.35)}

  /* chips premium / preferências */
  .chips{display:flex; gap:10px; flex-wrap:wrap; margin:10px auto 14px; justify-content:center}
  .chip-premium{background:#0d1320; color:var(--text); border:2px solid var(--amber-3); padding:10px 14px; border-radius:999px; font-weight:900; letter-spacing:.2px; box-shadow: 0 4px 16px rgba(255,140,0,.15)}
  .chip-premium:hover{ box-shadow: 0 0 0 2px rgba(255,140,0,.35), 0 8px 20px rgba(255,140,0,.25); transform:translateY(-1px) }
  .chip-premium.active{
    outline:2px solid rgba(49,225,255,.35);
    box-shadow:0 0 0 2px rgba(49,225,255,.25), 0 8px 20px rgba(49,225,255,.18);
  }

  .muted{color:#9aa4b2}
  .card{background:linear-gradient(180deg,#121826,#0c111b); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:12px}

  /* grid de pastas (home e subpastas) */
  .grid{display:grid; gap:12px; margin-top:10px}
  @media(min-width:1024px){ .grid{grid-template-columns: repeat(4, 1fr);} }
  @media(min-width:740px) and (max-width:1023px){ .grid{grid-template-columns: repeat(3, 1fr);} }
  @media(max-width:739px){ .grid{grid-template-columns: repeat(2, 1fr);} }
  .folderBtn{display:flex; align-items:center; justify-content:center; text-align:center; min-height:92px; padding:10px; border-radius:18px; cursor:pointer; background:linear-gradient(180deg, var(--amber-2), var(--amber-3)); color:#0b0f14; font-weight:900; font-size:20px; text-transform:uppercase; border:2px solid #ffcc6b; box-shadow: 0 6px 20px rgba(255,140,0,.25); position:relative}
  .folderBtn::after{ content:"›"; position:absolute; right:10px; top:8px; font-size:22px; font-weight:900; opacity:.9; }

  /* ===== LISTA ===== */
  .list{margin:0; padding:0}
  .track{ list-style:none; position:relative; display:flex; align-items:center; gap:10px;
    background:#0f1726; border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:10px 8px 10px 10px; margin:6px 0; box-shadow:0 3px 12px rgba(0,0,0,.14) }
  .track.dragging{opacity:.75; outline:2px dashed rgba(255,255,255,.25)}
  .track.playing{ background:linear-gradient(180deg, var(--amber-2), var(--amber-3)); color:#0b0f14; border-color:#ffcc6b; box-shadow:0 6px 22px rgba(255,140,0,.35) }
  .track.playing .t-sub{color:#0b0f14; opacity:.85}
  .t-left{display:grid; place-items:center}
  .t-play{ width:40px; height:40px; border-radius:999px; background:linear-gradient(180deg,#ff9f1a,#ff6a00); border:none; color:#fff; display:grid; place-items:center; cursor:pointer; box-shadow:0 6px 18px rgba(255,140,0,.26); font-weight:900 }
  .t-titleBox{min-width:0; display:flex; flex-direction:column; gap:2px}
  .t-title{font-weight:900; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
  .t-sub{font-size:11px; color:var(--muted); margin-top:0}
  .t-right{margin-left:auto; display:flex; align-items:center; gap:6px}
  .t-kebab{width:36px; height:36px; background:transparent; border:none; display:grid; place-items:center; cursor:pointer}

  .t-menu{ position:absolute; right:6px; top:52px; background:#0f1720; border:1px solid rgba(255,255,255,.12); padding:10px; border-radius:12px; display:none; min-width:240px; z-index:5; text-align:right; }
  .t-menu.open{display:block}
  .t-menu .menu-item{ width:100%; text-align:right; padding:10px 12px; border-radius:10px; color:#e6ecf2; background:transparent; border:1px solid transparent; cursor:pointer; font-weight:700; display:block; }
  .t-menu .menu-item:hover{background:#141e2e; border-color:rgba(255,255,255,.06)}

  .loadmore-wrap{display:flex; justify-content:center; margin:12px 0 4px}
  .btn{appearance:none; border:1px solid rgba(255,255,255,.12); background:#121b2b; color:#e6ecf2; padding:12px 16px; border-radius:14px; cursor:pointer; font-weight:700}
  .btn:hover{transform:translateY(-1px)}
  .btn-primary{border:none; background:linear-gradient(180deg,#ff8b24,#ff6a00); color:#0b0f14}

  /* =================== PLAYER =================== */
  footer.player{position:fixed; left:0; right:0; bottom:0; z-index:20; background:transparent}
  .player-shell{max-width:980px; margin:0 auto 16px; padding:14px 16px; background:#0c1117; border:1px solid rgba(255,255,255,.08); border-radius:24px; box-shadow:0 24px 60px rgba(0,0,0,.55)}
  .p-top{display:flex; align-items:center; gap:10px; margin-bottom:8px}
  .track-title{font-weight:900; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
  .track-right{margin-left:auto; display:flex; align-items:center; gap:8px}
  .kebab{width:34px; height:34px; border-radius:10px; background:transparent; border:none; color:#e6ecf2; display:grid;place-items:center; cursor:pointer}
  .track-sub{font-size:12px; color:#9aa4b2; margin-top:-2px}
  .progress{width:100%; margin-bottom:10px}
  .seek{appearance:none; width:100%; height:6px; border-radius:999px; background:#2a3342; outline:none}
  .seek::-webkit-slider-thumb{appearance:none; width:18px; height:18px; border-radius:50%; background:#fff; border:2px solid #bbb}
  .seek::-moz-range-thumb{width:18px; height:18px; border-radius:50%; background:#fff; border:2px solid #bbb}

  .p-controls{display:flex; align-items:center; justify-content:space-between}
  .p-btn{width:44px; height:44px; border:none; background:transparent; color:#fff; display:grid; place-items:center; cursor:pointer; padding:0}
  .p-btn svg{width:28px; height:28px; stroke:#ffffff; opacity:.9}
  .p-btn:hover svg{opacity:1; filter:drop-shadow(0 0 4px rgba(255,255,255,.25))}
  .p-btn.active svg{stroke:#31e1ff}
  .p-play{width:62px; height:62px; border-radius:999px; background:linear-gradient(180deg,#ff9f1a,#ff6a00); color:#0b0f14; border:none; display:grid; place-items:center; box-shadow:0 8px 30px rgba(255,140,0,.35)}
  .p-play svg{width:28px; height:28px; stroke:#ffffff}

  .vol-pop{position:absolute; bottom:64px; right:16px; background:#0f1720; border:1px solid rgba(255,255,255,.12); padding:8px; border-radius:12px; display:none}
  .vol-pop.open{display:block}
  .vol-range{appearance:none; width:160px; height:6px; border-radius:999px; background:#2a3342}
  .vol-range::-webkit-slider-thumb{appearance:none; width:14px; height:14px; border-radius:50%; background:#fff; border:2px solid #bbb}
  .vol-range::-moz-range-thumb{width:14px; height:14px; border-radius:50%; background:#fff; border:2px solid #bbb}

  .menu-pop{position:absolute; bottom:64px; right:54px; background:#0f1720; border:1px solid rgba(255,255,255,.12); padding:8px; border-radius:12px; display:none; min-width:240px}
  .menu-pop.open{display:block}
  .menu-pop .menu-item{width:100%; text-align:left; padding:10px 10px; border-radius:10px; color:#e6ecf2; background:transparent; border:1px solid transparent; cursor:pointer}
  .menu-pop .menu-item:hover{background:#141e2e; border-color:rgba(255,255,255,.06)}

  /* Smartphones */
  @media(max-width:440px){
    .t-play{width:36px;height:36px}
    .t-title{font-size:13px}
    .t-kebab{width:34px;height:34px}
    .track{padding:9px 6px}
  }
</style>
</head>
<body class="theme-default">
  <div class="wrap" id="app" style="display:none">
    <header>
      <div class="userbox" id="userBtn" title="Abrir menu">
        <div class="avatar" id="avatarIcon"></div>
      </div>

      <div id="menuBackdrop" class="backdrop"></div>
      <div class="menu" id="userMenu" aria-hidden="true">
        <h4>MENU</h4>
        <button class="mi" data-act="home"      id="miHome"></button>
        <button class="mi" data-act="account"   id="miAccount"></button>
        <button class="mi" data-act="search"    id="miSearch"></button>
        <button class="mi" data-act="playlists" id="miPlaylists"></button>
        <button class="mi" data-act="downloads" id="miDowns"></button>
        <button class="mi" data-act="favs"      id="miFavs"></button>
        <button class="mi" data-act="billing"   id="miBilling"></button>
        <button class="mi" data-act="settings"  id="miSettings"></button>
        <button class="mi" data-act="notify"    id="miNotify"></button>
        <div class="sep"></div>
        <button class="mi" data-act="help"      id="miHelp"></button>
        <div class="sep"></div>
        <button class="mi" data-act="logout"    id="miLogout"></button>
      </div>

      <div class="logo-wrap">
        <picture>
          <source srcset="/logolove.webp" type="image/webp">
          <img class="logo" src="/loove-logo.png" alt="Loove music">
        </picture>
      </div>
      <div class="tagline">TODO MUNDO AMA MÚSICA</div>

      <div class="search">
        <span id="searchIco" class="s-ico"></span>
        <input id="q" type="search" placeholder="Qual música você quer ouvir?" />
      </div>

      <!-- chips premium (atalhos) -->
      <div class="chips" id="chipsPremium">
        <button class="chip-premium" data-p="top1000">TOP-1.000</button>
        <button class="chip-premium" data-p="summer">SUMMER ELETRO HITS</button>
        <button class="chip-premium" data-p="jovempan">JOVEM PAN</button>
        <button class="chip-premium" data-p="setsremix">SETS REMIX</button>
        <button class="chip-premium" data-p="secret">PLAYLIST SECRETA</button>
        <button class="chip-premium" data-p="flashbackgold">FLASHBACK GOLD</button>
        <button class="chip-premium" data-p="topmundogold">TOP - MUNDO GOLD</button>
      </div>
    </header>

    <!-- HOME -->
    <section id="viewHome">
      <div class="grid" id="foldersGrid"></div>
    </section>

    <!-- LISTA -->
    <section id="viewList" class="card" style="display:none">
      <div id="subfoldersWrap" style="display:none; margin-bottom:8px">
        <div class="grid" id="subfoldersGrid"></div>
      </div>
      <ul id="list" class="list"></ul>
      <div class="loadmore-wrap">
        <button id="btnMore" class="btn">Carregar mais</button>
      </div>
    </section>

    <!-- FAVORITOS -->
    <section id="viewFavs" class="card" style="display:none">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px">
        <h3 style="margin:0">Favoritos</h3>
        <button id="btnFavPlayAll" class="btn btn-primary" title="Escutar todas">▶ Escutar todas</button>
      </div>
      <div id="favList"></div>
    </section>

    <!-- MINHAS PLAYLISTS -->
    <section id="viewPlaylists" class="card" style="display:none">
      <div class="pl-head">
        <h3 style="margin:0">Minhas playlists</h3>
        <button id="btnCreatePl" class="btn btn-primary">+ Criar playlist</button>
      </div>
      <div id="myPlGrid" class="pl-grid"></div>
    </section>

    <!-- CONTA -->
    <section id="viewAccount" class="card" style="display:none">
      <h3 style="margin-top:0">Conta</h3>
      <p class="muted">Gerencie suas informações de acesso.</p>
      <div style="display:flex; flex-direction:column; gap:12px; max-width:400px">
        <label>
          <span class="muted">Nome do usuário</span>
          <input id="accName" type="text" placeholder="Seu nome" 
                 style="width:100%; padding:10px 12px; border-radius:12px; 
                 border:1px solid rgba(255,255,255,.12); background:#0d1320; color:#e6ecf2">
        </label>
        <label>
          <span class="muted">E-mail</span>
          <input id="accEmail" type="email" value="usuario@exemplo.com" disabled
                 style="width:100%; padding:10px 12px; border-radius:12px; 
                 border:1px solid rgba(255,255,255,.12); background:#0d1320; color:#9aa4b2">
        </label>
        <div><span class="muted">Plano:</span> <strong id="accPlan" style="margin-left:6px">Free</strong></div>
        <button id="btnUpgrade" class="btn btn-primary"
                style="background:linear-gradient(180deg,#ff9f1a,#ff6a00);color:#0b0f14;font-weight:900;">
          Quero ser Premium
        </button>
        <div style="margin-top:12px">
          <button id="btnLogout2" class="btn">Sair da conta</button>
        </div>
      </div>
    </section>

    <!-- DOWNLOADS -->
    <section id="viewDownloads" class="card" style="display:none">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px">
        <h3 style="margin:0">Downloads (Off-line)</h3>
        <div id="dlUsage" class="muted">Uso: 0 MB / 500 MB</div>
      </div>
      <div id="dlList"></div>
    </section>

    <!-- ASSINATURAS -->
    <section id="viewBilling" class="card" style="display:none">
      <h3 style="margin-top:0">Assinaturas</h3>
      <p class="muted">Desbloqueie playlists premium e downloads ilimitados (dentro do limite local).</p>
      <div style="display:flex; gap:8px; flex-wrap:wrap">
        <button id="btnGoPremium" class="btn btn-primary">Assinar Premium</button>
      </div>
    </section>

    <!-- CONFIGURAÇÕES -->
    <section id="viewSettings" class="card" style="display:none">
      <h3 style="margin-top:0" data-i18n="settings_title">Configurações</h3>

      <div style="display:flex; flex-direction:column; gap:14px; max-width:560px">

        <!-- Tema do App -->
        <div class="cfg-row">
          <label class="muted" for="cfgTheme">🎨 Tema do App</label>
          <select id="cfgTheme" style="width:260px; padding:10px 12px; border-radius:12px;
                   border:1px solid rgba(255,255,255,.12); background:#0d1320; color:var(--text)">
            <option value="default">Cor Atual</option>
            <option value="pink">Rosa Neon</option>
            <option value="green">Verde Neon</option>
            <option value="black">Black</option>
          </select>
        </div>

        <!-- Preferência musical -->
        <div>
          <label class="muted" data-i18n="music_pref">Preferência musical</label>
          <div id="prefChips" class="chips" style="justify-content:flex-start; margin-top:8px">
            <button class="chip-premium" data-genre="Pop">Pop</button>
            <button class="chip-premium" data-genre="Eletrônica">Eletrônica</button>
            <button class="chip-premium" data-genre="Sertanejo">Sertanejo</button>
            <button class="chip-premium" data-genre="Funk">Funk</button>
            <button class="chip-premium" data-genre="Rock">Rock</button>
            <button class="chip-premium" data-genre="Pagode">Pagode</button>
            <button class="chip-premium" data-genre="Forró">Forró</button>
            <button class="chip-premium" data-genre="Hip Hop">Hip Hop</button>
            <button class="chip-premium" data-genre="MPB">MPB</button>
            <button class="chip-premium" data-genre="Gospel">Gospel</button>
          </div>
          <div class="muted" id="prefSummary" style="font-size:12px; margin-top:6px"></div>
        </div>

        <!-- Idioma do app -->
        <label class="muted" for="cfgLang" data-i18n="lang_label">Idioma do App</label>
        <select id="cfgLang" style="width:260px; padding:10px 12px; border-radius:12px;
                 border:1px solid rgba(255,255,255,.12); background:#0d1320; color:var(--text)">
          <option value="pt">Português</option>
          <option value="es">Español</option>
          <option value="en">English</option>
        </select>

        <!-- Mix DJ (Crossfade) -->
        <div>
          <label class="muted" for="cfgMix" data-i18n="mix_label">Mix DJ (crossfade)</label>
          <div style="display:flex; align-items:center; gap:12px; margin-top:6px">
            <input id="cfgMix" type="range" min="0" max="12" step="1" style="width:260px">
            <strong id="cfgMixVal">0s</strong>
          </div>
          <p class="muted" data-i18n="mix_hint" style="margin:6px 0 0; font-size:12px">
            Dica: 6–8s costuma soar natural em músicas pop/eletrônica.
          </p>
        </div>

        <!-- Volume geral do app -->
        <label class="muted" data-i18n="app_volume">Volume do app
          <input id="cfgVol" type="range" min="0" max="1" step="0.01" style="width:260px; display:block; margin-top:6px">
        </label>

        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:4px">
          <button id="btnClearPlayback" class="btn" data-i18n="clear_memory">Limpar memória de reprodução</button>
        </div>
      </div>
    </section>

    <!-- NOTIFICAÇÕES -->
    <section id="viewNotify" class="card" style="display:none">
      <h3 style="margin-top:0">Notificações</h3>
      <p class="muted">Escolha quais tipos de aviso deseja receber.</p>
      <div style="display:flex; flex-direction:column; gap:16px; max-width:420px">
        <label class="switch-row">
          <span>🎵 Músicas novas</span>
          <input type="checkbox" class="notif-switch" data-key="musicas">
          <span class="slider"></span>
        </label>
        <label class="switch-row">
          <span>🌟 Novidades e sucessos</span>
          <input type="checkbox" class="notif-switch" data-key="novidades">
          <span class="slider"></span>
        </label>
        <label class="switch-row">
          <span>🎧 Playlists especiais</span>
          <input type="checkbox" class="notif-switch" data-key="playlists">
          <span class="slider"></span>
        </label>
        <div style="margin-top:12px">
          <button id="btnNotifAll" class="btn btn-primary"
                  style="background:linear-gradient(180deg,#ff9f1a,#ff6a00); color:#0b0f14; font-weight:900;">
            🔔 Ativar/Desativar todas as notificações
          </button>
        </div>
      </div>
    </section>
  </div>

  <!-- LOGIN -->
  <section id="viewLogin" class="card" style="max-width:420px;margin:60px auto; display:none">
    <h2>Entrar</h2>
    <p class="muted">Digite seu PIN para acessar o app.</p>
    <form id="formLogin" class="row" onsubmit="return false;">
      <input id="pin" type="password" inputmode="numeric" minlength="3" maxlength="8" placeholder="Ex.: 2468" style="flex:1; padding:12px 14px; border-radius:14px; border:1px solid rgba(255,255,255,.12); background:#0d1320; color:var(--text)">
      <button id="btnLogin" class="btn btn-primary" type="submit">Entrar</button>
    </form>
    <div id="msg" class="muted" style="margin-top:8px"></div>
  </section>

  <!-- MODAL: Seletor de Playlist -->
  <div id="plModal" class="pl-modal" aria-hidden="true">
    <div class="pl-card">
      <div class="pl-title">
        <h3 style="margin:0">Adicionar à playlist</h3>
        <button id="plClose" class="pl-close" title="Fechar">✕</button>
      </div>
      <div id="plList"></div>
    </div>
  </div>

  <!-- =================== PLAYER (A/B para crossfade) =================== -->
  <footer class="player">
    <div class="player-shell">
      <div class="p-top">
        <div>
          <div class="track-title" id="nowTitle">Nada tocando</div>
          <div class="track-sub" id="nowFolder">—</div>
        </div>
        <div class="track-right">
          <div id="nowTime" class="muted">0:00 / 0:00</div>
          <button id="btnKebab" class="kebab" title="Opções">⋯</button>
        </div>
      </div>
      <div class="progress"><input id="seek" class="seek" type="range" min="0" max="1000" value="0" /></div>
      <div class="p-controls">
        <button id="pHome"   class="p-btn" title="Início"></button>
        <button id="pSearch" class="p-btn" title="Buscar"></button>
        <button id="pPrev"   class="p-btn" title="Voltar"></button>
        <button id="pPlay"   class="p-play" title="Play/Pause"></button>
        <button id="pNext"   class="p-btn" title="Avançar"></button>
        <button id="pShuffle" class="p-btn" title="Shuffle"></button>
        <button id="pRepeat"  class="p-btn" title="Repeat"></button>
        <div style="position:relative">
          <button id="pVolume"  class="p-btn" title="Volume"></button>
          <div id="volPop" class="vol-pop">
            <input id="volRange" class="vol-range" type="range" min="0" max="1" step="0.01" value="1" />
          </div>
        </div>
      </div>
      <div id="menuPop" class="menu-pop">
        <button class="menu-item" id="miShare">Compartilhar</button>
        <button class="menu-item" id="miFav">Favoritar</button>
        <button class="menu-item" id="miDown">Baixar (Premium)</button>
        <button class="menu-item" id="miCreatePl">Criar playlist</button>
        <button class="menu-item" id="miSavePl">Salvar playlist</button>
      </div>
    </div>
    <!-- Players A/B para crossfade (Mix DJ) -->
    <audio id="audioA" crossorigin="anonymous"></audio>
    <audio id="audioB" crossorigin="anonymous" style="display:none"></audio>
  </footer>
  
<script>

/* ===== Helpers & Keys ===== */
const el = (id) => document.getElementById(id);
const THEME_KEY = "loove_theme_v1";
const PREF_MUSIC_KEY = "loove_pref_music_v1";
const LANG_KEY = "loove_lang_v1";
const MIX_KEY = "loove_mix_v1";
const PLAYBACK_KEY = "loove_playback_v2"; // título/pasta/pos/playing

/* ===== i18n básico ===== */
const I18N = {
  pt: {
    settings_title: "Configurações",
    music_pref: "Preferência musical",
    lang_label: "Idioma do App",
    mix_label: "Mix DJ (crossfade)",
    mix_hint: "Dica: 6–8s costuma soar natural em músicas pop/eletrônica.",
    app_volume: "Volume do app",
    clear_memory: "Limpar memória de reprodução",
    nothing_playing: "Nada tocando",
  },
  es: {
    settings_title: "Configuraciones",
    music_pref: "Preferencia musical",
    lang_label: "Idioma de la app",
    mix_label: "DJ Mix (crossfade)",
    mix_hint: "Tip: 6–8s suele sonar natural en pop/electrónica.",
    app_volume: "Volumen de la app",
    clear_memory: "Limpiar memoria de reproducción",
    nothing_playing: "Nada sonando",
  },
  en: {
    settings_title: "Settings",
    music_pref: "Music preference",
    lang_label: "App Language",
    mix_label: "DJ Mix (crossfade)",
    mix_hint: "Tip: 6–8s usually sounds natural for pop/electronic.",
    app_volume: "App volume",
    clear_memory: "Clear playback memory",
    nothing_playing: "Nothing playing",
  }
};
function applyI18n(lang){
  const dict = I18N[lang] || I18N.pt;
  document.querySelectorAll("[data-i18n]").forEach(node=>{
    const k = node.getAttribute("data-i18n");
    if(dict[k]) node.textContent = dict[k];
  });
  // Placeholder do search, se existir
  const q = el("q");
  if(q){
    if(lang==="es") q.placeholder = "¿Qué canción quieres escuchar?";
    else if(lang==="en") q.placeholder = "What song do you want to hear?";
    else q.placeholder = "Qual música você quer ouvir?";
  }
}

/* ===== Tema ===== */
function setTheme(theme){
  const body = document.body;
  body.classList.remove("theme-default","theme-pink","theme-green","theme-black");
  body.classList.add(`theme-${theme}`);
  localStorage.setItem(THEME_KEY, theme);
  const sel = el("cfgTheme");
  if(sel) sel.value = theme;
}
function initTheme(){
  const saved = localStorage.getItem(THEME_KEY) || "default";
  setTheme(saved);
  const sel = el("cfgTheme");
  if(sel){
    sel.value = saved;
    sel.addEventListener("change", ()=> setTheme(sel.value));
  }
}

/* ===== Preferência musical (chips múltiplos) ===== */
function loadMusicPrefs(){
  try{ return JSON.parse(localStorage.getItem(PREF_MUSIC_KEY)||"[]"); }catch{return [];}
}
function saveMusicPrefs(arr){ localStorage.setItem(PREF_MUSIC_KEY, JSON.stringify(arr||[])); }
function refreshPrefUI(){
  const saved = new Set(loadMusicPrefs());
  const chips = document.querySelectorAll("#prefChips .chip-premium");
  chips.forEach(c=>{
    const g = c.getAttribute("data-genre");
    c.classList.toggle("active", saved.has(g));
  });
  const sum = el("prefSummary");
  if(sum){
    if(saved.size===0) sum.textContent = "Nenhum estilo selecionado.";
    else sum.textContent = "Preferências: " + Array.from(saved).join(", ");
  }
}
function initMusicPrefs(){
  const chipsWrap = el("prefChips");
  if(!chipsWrap) return;
  chipsWrap.addEventListener("click",(ev)=>{
    const btn = ev.target.closest(".chip-premium");
    if(!btn) return;
    const g = btn.getAttribute("data-genre");
    const set = new Set(loadMusicPrefs());
    if(set.has(g)) set.delete(g); else set.add(g);
    saveMusicPrefs(Array.from(set));
    refreshPrefUI();
  });
  refreshPrefUI();
}

/* ===== Idioma ===== */
function initLang(){
  const sel = el("cfgLang");
  const saved = localStorage.getItem(LANG_KEY) || "pt";
  if(sel) sel.value = saved;
  applyI18n(saved);
  if(sel){
    sel.addEventListener("change", ()=>{
      localStorage.setItem(LANG_KEY, sel.value);
      applyI18n(sel.value);
    });
  }
}

/* ====== Player com Crossfade (audioA/audioB) ====== */
const aA = el("audioA");
const aB = el("audioB");
let active = aA;       // elemento em uso
let standby = aB;      // próximo a tocar
let crossfadeSec = parseInt(localStorage.getItem(MIX_KEY)||"0",10) || 0;
let userPaused = false;

const nowTitle = el("nowTitle");
const nowFolder = el("nowFolder");
const nowTime = el("nowTime");
const seek = el("seek");
const pPlay = el("pPlay");
const pPrev = el("pPrev");
const pNext = el("pNext");
const pVolume = el("pVolume");
const volRange = el("volRange");

function fmt(t){ if(!isFinite(t)||t<0) return "0:00"; const m=Math.floor(t/60), s=Math.floor(t%60); return m+":"+(s<10?"0":"")+s; }
function updateTimeUI(){
  const cur = active;
  const dur = cur.duration||0, pos = cur.currentTime||0;
  if(nowTime) nowTime.textContent = `${fmt(pos)} / ${fmt(dur)}`;
  if(seek){
    seek.value = (dur>0 && !isNaN(dur)) ? Math.round((pos/dur)*1000) : 0;
  }
}
[aA,aB].forEach(a=>{
  a.addEventListener("timeupdate", updateTimeUI);
  a.addEventListener("loadedmetadata", updateTimeUI);
  a.addEventListener("ended", ()=>{ setPlayIcon(false); });
});

function setPlayIcon(isPlaying){
  if(!pPlay) return;
  pPlay.innerHTML = isPlaying
    ? `<svg viewBox="0 0 24 24" fill="none"><path d="M8 5v14M16 5v14" stroke="#ffffff" stroke-width="2.6" stroke-linecap="round"/></svg>`
    : `<svg viewBox='0 0 24 24' fill='none'><path d='M8 5l11 7-11 7V5z' stroke-width='2.2' stroke-linejoin='round' stroke='#ffffff'/></svg>`;
}

function setMeta(meta){
  if(meta?.title && nowTitle) nowTitle.textContent = meta.title;
  if(meta?.folder && nowFolder) nowFolder.textContent = meta.folder;
  if(!meta?.title && nowTitle){
    const lang = localStorage.getItem(LANG_KEY)||"pt";
    nowTitle.textContent = (I18N[lang]||I18N.pt).nothing_playing;
  }
}

function setVolume(v){
  [aA,aB].forEach(a=> a.volume = v);
  if(volRange) volRange.value = String(v);
  const cfgVol = el("cfgVol");
  if(cfgVol) cfgVol.value = String(v);
}

function crossfadeTo(src, meta){
  // se não estiver tocando nada, apenas carrega no ativo
  if(!active.src){
    active.src = src;
    setMeta(meta);
    active.play().then(()=>{ setPlayIcon(true); userPaused=false; savePlaybackState(true); }).catch(()=>{});
    return;
  }

  // Troca standby ↔ ativo
  const old = active, next = standby;
  next.src = src;
  next.currentTime = 0;
  next.volume = 0;

  // Sincroniza volume atual
  next.muted = false;
  setMeta(meta);

  const doStart = ()=> next.play().catch(()=>{});

  if(crossfadeSec <= 0){
    // Sem crossfade: pausa o antigo e toca o novo
    old.pause();
    doStart();
    active = next; standby = old;
    setPlayIcon(true); userPaused=false; savePlaybackState(true);
    return;
  }

  // Com crossfade: sobe o novo e desce o antigo
  doStart();
  const steps = 30; // suavidade
  let i = 0;
  const iv = setInterval(()=>{
    i++;
    const t = Math.min(1, i/steps);
    next.volume = t;
    old.volume = 1 - t;
    if(i >= steps){
      clearInterval(iv);
      old.pause();
      old.currentTime = 0;
      old.src = ""; // libera
      // garante volume final do ativo
      next.volume = volRange ? Number(volRange.value) : 1;
      active = next; standby = old;
      setPlayIcon(true); userPaused=false; savePlaybackState(true);
    }
  }, (crossfadeSec*1000)/steps);
}

function savePlaybackState(playing){
  try{
    const meta = {
      title: nowTitle?.textContent || "",
      folder: nowFolder?.textContent || "",
      pos: Math.floor(active?.currentTime || 0),
      playing: !!playing
    };
    localStorage.setItem(PLAYBACK_KEY, JSON.stringify(meta));
  }catch{}
}

function restorePlaybackState(){
  try{
    const st = JSON.parse(localStorage.getItem(PLAYBACK_KEY)||"{}");
    if(st.title) setMeta({title: st.title, folder: st.folder});
    setPlayIcon(!!st.playing);
  }catch{}
}

/* ===== API global para outras partes do app ===== */
window.Loove = {
  playUrl: (url, meta={})=> crossfadeTo(url, meta),
  setCrossfade: (sec)=>{ crossfadeSec = Math.max(0, Number(sec)||0); localStorage.setItem(MIX_KEY, String(crossfadeSec)); el("cfgMix") && (el("cfgMix").value = crossfadeSec); el("cfgMixVal") && (el("cfgMixVal").textContent = crossfadeSec+"s"); },
  setVolume,
  getCurrentAudio: ()=> active
};

/* ===== Controles do player (UI mínima) ===== */
seek && seek.addEventListener("input", ()=>{
  const dur = active.duration||0;
  if(dur>0) active.currentTime = (Number(seek.value)/1000)*dur;
  updateTimeUI();
});

pPlay && (pPlay.onclick = ()=>{
  if(!active.src) return;
  if(active.paused){ active.play().then(()=>{ setPlayIcon(true); userPaused=false; savePlaybackState(true);}).catch(()=>{}); }
  else { active.pause(); setPlayIcon(false); userPaused=true; savePlaybackState(false); }
});

// pPrev/pNext: como não temos fila global aqui, deixamos disponíveis
// para você plugar sua lógica de lista. Exemplo:
// window.LoovePrevHandler = ()=>{ ... toca anterior chamando playUrl(...) }
// window.LooveNextHandler = ()=>{ ... toca próxima chamando playUrl(...) }
pPrev && (pPrev.onclick = ()=>{ if(typeof window.LoovePrevHandler==="function") window.LoovePrevHandler(); });
pNext && (pNext.onclick = ()=>{ if(typeof window.LooveNextHandler==="function") window.LooveNextHandler(); });

/* ===== Volume (popup e config) ===== */
volRange && volRange.addEventListener("input", ()=> setVolume(Number(volRange.value)));
const cfgVol = el("cfgVol");
cfgVol && cfgVol.addEventListener("input", ()=> setVolume(Number(cfgVol.value)));

/* ===== Mix DJ (config) ===== */
function initMix(){
  const mix = el("cfgMix");
  const val = el("cfgMixVal");
  crossfadeSec = parseInt(localStorage.getItem(MIX_KEY)||"0",10) || 0;
  if(mix){
    mix.value = String(crossfadeSec);
    val && (val.textContent = crossfadeSec + "s");
    mix.addEventListener("input", ()=>{
      crossfadeSec = Math.max(0, parseInt(mix.value||"0",10));
      localStorage.setItem(MIX_KEY, String(crossfadeSec));
      val && (val.textContent = crossfadeSec + "s");
    });
  }
}

/* ===== Botão: Limpar memória reprodução ===== */
const btnClear = el("btnClearPlayback");
btnClear && (btnClear.onclick = ()=>{ localStorage.removeItem(PLAYBACK_KEY); alert("Memória de reprodução limpa."); });

/* ===== Volume inicial ===== */
(function initVolumeOnce(){
  const v = cfgVol ? Number(cfgVol.value||1) : 1;
  setVolume(v);
})();

/* ===== Inicialização ===== */
(function boot(){
  initTheme();
  initMusicPrefs();
  initLang();
  initMix();
  restorePlaybackState();
  // Ícones do botão de play
  setPlayIcon(false);
})();

/* ===== Exemplo de integração simples (opcional) =====
   Se você tem botões/itens de lista e quer testar rápido:
   document.querySelectorAll("[data-demo-url]").forEach(btn=>{
     btn.addEventListener("click", ()=>{
       window.Loove.playUrl(
         btn.getAttribute("data-demo-url"),
         { title: btn.getAttribute("data-title")||"Demo", folder: btn.getAttribute("data-folder")||"Demo" }
       );
     });
   });
*/
</script>
</body>
</html>
