document.getElementById("playBtn").addEventListener("click",()=>{
  const audioA = document.getElementById("audioPlayer");
  const audioB = document.getElementById("audioPlayerB");
  const active = activePlayer==="A"?audioA:audioB;

  if(!currentTrack || !active.src){
    // Sem faixa carregada: não faz nada
    return;
  }

  if(isPlaying){
    active.pause();
    isPlaying=false;
    document.getElementById("playBtn").textContent="▶";
  }else{
    active.play();
    isPlaying=true;
    document.getElementById("playBtn").textContent="⏸";
  }
});

document.getElementById("prevBtn").addEventListener("click",()=>{/* implementar navegação para faixa anterior */});
document.getElementById("nextBtn").addEventListener("click",()=>{/* implementar navegação para próxima faixa */});

document.getElementById("shuffleBtn").addEventListener("click",()=>{
  shuffle = !shuffle;
  document.getElementById("shuffleBtn").style.opacity = shuffle ? "1" : "0.7";
});

document.getElementById("repeatBtn").addEventListener("click",()=>{
  repeat = !repeat;
  document.getElementById("repeatBtn").style.opacity = repeat ? "1" : "0.7";
  const audioA = document.getElementById("audioPlayer");
  const audioB = document.getElementById("audioPlayerB");
  audioA.loop = repeat;
  audioB.loop = repeat;
});

const seekBar = document.getElementById("seekBar");
const volumeBar = document.getElementById("volumeBar");
const audioA = document.getElementById("audioPlayer");
const audioB = document.getElementById("audioPlayerB");

function bindAudioEvents(a){
  a.addEventListener("timeupdate",()=>{
    if(!isNaN(a.duration) && a.duration>0){
      seekBar.value = Math.floor((a.currentTime / a.duration) * 100);
    }
  });
  a.addEventListener("ended",()=>{
    if(repeat){
      a.currentTime = 0;
      a.play();
      return;
    }
    // Próxima faixa: implementar quando houver fila
    isPlaying=false;
    document.getElementById("playBtn").textContent="▶";
  });
}

bindAudioEvents(audioA);
bindAudioEvents(audioB);

seekBar.addEventListener("input",()=>{
  const active = activePlayer==="A"?audioA:audioB;
  if(active.duration && active.duration>0){
    active.currentTime = (seekBar.value/100) * active.duration;
  }
});

volumeBar.addEventListener("input",()=>{
  const v = Number(volumeBar.value);
  audioA.volume = v;
  audioB.volume = v;
});

function playWithCrossfade(url){
  const from = activePlayer==="A"?audioA:audioB;
  const to   = activePlayer==="A"?audioB:audioA;

  if(!crossfadeEnabled || !isPlaying || from.paused){
    // troca direta
    to.src = url;
    to.currentTime = 0;
    to.volume = volumeBar.value;
    to.play();
    activePlayer = (activePlayer==="A")?"B":"A";
    isPlaying = true;
    document.getElementById("playBtn").textContent="⏸";
    return;
  }

  // crossfade simples
  const steps = 20;
  const total = Math.max(1, crossfadeDuration);
  const stepMs = (total*1000)/steps;

  to.src = url;
  to.currentTime = 0;
  to.volume = 0;
  to.play();

  let i=0;
  const startVol = from.volume;
  const targetVol = Number(volumeBar.value);

  const tm = setInterval(()=>{
    i++;
    const t = i/steps;
    to.volume = Math.min(targetVol, t*targetVol);
    from.volume = Math.max(0, startVol*(1-t));
    if(i>=steps){
      clearInterval(tm);
      from.pause();
      from.volume = targetVol;
      activePlayer = (activePlayer==="A")?"B":"A";
      isPlaying = true;
      document.getElementById("playBtn").textContent="⏸";
    }
  }, Math.max(16, stepMs));
}

// Exemplo público de chamada (depois que tiver URL da música):
// playWithCrossfade("https://exemplo.com/musica.mp3");

</script>
</body>
</html>
